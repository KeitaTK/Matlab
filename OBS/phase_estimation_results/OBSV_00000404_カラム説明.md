# OBSV_data_00000404.csv 各カラムの説明（日本語）

このドキュメントは、`AP_Observer.cpp` の `Write_Observer_Log()` 関数で記録されるデータの各カラム（変数）の意味・内容を日本語でまとめたものです。

## カラム一覧と説明

| カラム名    | 説明                                              | 単位・備考 |
|:------------|:--------------------------------------------------|:-----------|
| **TimeUS**  | タイムスタンプ（マイクロ秒単位）                   | μs |
| **PLX**     | ペイロード外力 X成分（`_payload_filtered.x`）     | N（フィルタ後） |
| **PLY**     | ペイロード外力 Y成分（`_payload_filtered.y`）     | N（フィルタ後） |
| **PLZ**     | ペイロード外力 Z成分（`_payload_filtered.z`）     | N（フィルタ後） |
| **AX**      | RLS推定パラメータ X軸の**sin係数**（`rls_theta[0][0]`） | A_x（sin項の振幅） |
| **AY**      | RLS推定パラメータ Y軸の**sin係数**（`rls_theta[1][0]`） | A_y（sin項の振幅） |
| **BX**      | RLS推定パラメータ X軸の**cos係数**（`rls_theta[0][1]`） | B_x（cos項の振幅） |
| **BY**      | RLS推定パラメータ Y軸の**cos係数**（`rls_theta[1][1]`） | B_y（cos項の振幅） |
| **CX**      | RLS推定パラメータ X軸の**定常偏差**（`rls_theta[0][2]`） | C_x（DC成分） |
| **CY**      | RLS推定パラメータ Y軸の**定常偏差**（`rls_theta[1][2]`） | C_y（DC成分） |
| **PRX**     | **予測外力** X成分（`pred.x`）                     | N（Δt秒先の推定値） |
| **PRY**     | **予測外力** Y成分（`pred.y`）                     | N（Δt秒先の推定値） |
| **PRZ**     | **予測外力** Z成分（`pred.z`）                     | N（Δt秒先の推定値） |
| **ERR**     | **位相誤差**（`err`）                              | rad（推定vs実測の傾き差） |
| **EST_FREQ** | **推定周波数**（`est_freq`）                        | Hz（位相バッファから計算） |
| **CORR**    | **位相補正量**（`phase_correction`）               | rad（累積補正値） |

---

## RLS（Recursive Least Squares）パラメータについて

RLSアルゴリズムは、外力が以下の形式で表現されると仮定しています：

$$F(t) = A \cdot \sin(\omega t - \phi) + B \cdot \cos(\omega t - \phi) + C$$

ここで：
- **A（AX, AY）**: sin項の振幅（RLS推定値）
- **B（BX, BY）**: cos項の振幅（RLS推定値）
- **C（CX, CY）**: 定常偏差・DC成分（RLS推定値）
- **ω**: 設定された外乱周波数（rad/s）
- **φ**: 位相補正量（`CORR`）

予測外力（PRX, PRY, PRZ）は、これらのパラメータを使用して Δt秒後の外力を計算しています：

$$F_{pred}(t+\Delta t) = A \cdot \sin(\omega(t+\Delta t) - \phi) + B \cdot \cos(\omega(t+\Delta t) - \phi) + C$$

---

## 位相補正について

- **ERR（位相誤差）**: 実測の位相傾きと理想的な傾きの差から計算される誤差量
- **EST_FREQ（推定周波数）**: 位相バッファ（100サンプル）の傾き情報から推定される外乱周波数
- **CORR（位相補正量）**: RLSアルゴリズムの精度向上のために、位相にこの補正値を加算

---

## このプログラムで抜き出している情報

`plot_OBSV_00000404_all_columns.m` スクリプトは：
- 上記すべての数値カラムを時系列グラフ化し、`results` フォルダにPNG画像として保存しています。
- 時間軸は100Hzサンプリング（0.01秒刻み、行番号ベース）で作成しています。

---

## 主要な設定パラメータ

AP_Observerの初期化時に以下のパラメータが使用されます：

| パラメータ | デフォルト値 | 説明 |
|:----------|:-----------|:-----|
| `CORR_GAIN` | 0.004 | 外力に基づく姿勢補正ゲイン |
| `FILT_CUTOFF` | 20.0 Hz | 低域フィルタのカットオフ周波数 |
| `RLS_LAMBDA` | 0.98 | RLS忘却係数 |
| `RLS_COV_INIT` | 100.0 | RLS初期共分散値 |
| `DIST_FREQ` | 0.6 Hz | 周期外乱周波数（設定値） |
| `PRED_TIME` | 0.01 s | 予測時間（Δt） |
| `PHASE_CORR` | 1 | 位相補正有効/無効 |
| `PHASE_THRESH` | 10.0 rad | 位相補正の適用閾値 |

---

## 参考
- グラフファイル例: `OBSV_00000404_PLX.png`, `OBSV_00000404_ERR.png` など
- スクリプト: `plot_OBSV_00000404_all_columns.m`
- ソースコード: `AP_Observer.cpp` の `Write_Observer_Log()` 関数
