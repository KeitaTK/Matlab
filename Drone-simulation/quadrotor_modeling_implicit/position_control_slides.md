---
marp: true
theme: default
paginate: true
header: '機械動力学 最終レポート'
footer: '2026年2月2日'
---


<!-- _class: lead -->
# クアッドコプターの位置制御に関する動的シミュレーション

カスケード制御系におけるゲイン設定と応答特性の評価

---


## 1. シミュレーションの目的・背景

### 背景
- クアッドコプターの自律飛行には、姿勢安定化に加え、正確な**位置制御**が必須である。
- 位置制御系は姿勢制御系（内側ループ）の外側に配置される**カスケード構造**をとる。
- 適切な制御ゲインを選定しない場合、目標位置への収束遅れや残留振動が生じる。

### 目的
- 3次元空間内での位置制御シミュレーションを実施する。
- PID（PD）制御ゲインを変更した際のステップ応答を比較・評価する。
- クアッドコプターの動特性を考慮した適切な設計パラメータを見出す。

---
## カスケード構造とは？

<div style="text-align: center; margin-top: 20px;">
    <img src="https://ardupilot.org/dev/_images/Copter_CodeOverview_AttitudeControlPID.png" alt="ArduPilot Cascade Control" width="600" style="display: block; margin: 0 auto;" />
    <sub style="color: #666;">出典: ArduPilot ドキュメント</sub>
</div>

**カスケード制御**とは、複数の制御ループを階層的に組み合わせる構造です。

- クアッドコプターでは、外側ループ（位置制御）が目標位置から目標姿勢を生成し、内側ループ（姿勢制御）がその目標姿勢に追従します。


---

## 2. シミュレーション対象モデル

### クアッドコプターの諸元
- **質量**: $m = 0.7 [\text{kg}]$
- **慣性モーメント**: 
  $J_{xx} = 0.010, J_{yy} = 0.015, J_{zz} = 0.020 [\text{kg} \cdot \text{m}^2]$

### 制御系（カスケード制御）
1. **外側ループ（位置制御）**: 
   位置誤差から目標角度（ロール・ピッチ）を算出
2. **内側ループ（姿勢制御）**: 
   目標角度への追従トルクを生成
   (本解析では姿勢ゲインは固定)

---

## 3. シミュレーション条件

### 数値積分手法
- **手法**: Newmark-$\beta$法（陰解法）
- **パラメータ**: $\gamma = 0.5, \beta = 0.25$ (平均加速度法)
- **時間刻み**: $\Delta t = 0.01 [\text{s}]$
- **解析時間**: $60 [\text{s}]$

### 初期条件と目標値
- **初期位置**: $\mathbf{X}_0 = [10, 10, 10]^T [\text{m}]$
- **目標位置**: $\mathbf{X}_{ref} = [0, 0, 0]^T [\text{m}]$
- **初期姿勢・速度**: 全て $0$

---

## 4. 運動方程式

ラグランジュの運動方程式（並進・回転の連成）

$$
\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\mathbf{q}}} \right) - \frac{\partial L}{\partial \mathbf{q}} + \mathbf{C}(\mathbf{q}, \dot{\mathbf{q}})\dot{\mathbf{q}} = \mathbf{Q}
$$

- $L = K - P$: ラグランジアン
- $\mathbf{q} = [x, y, z, \phi, \theta, \psi]^T$: 一般化座標
- $\mathbf{Q}$: 制御入力（推力およびトルク）

クアッドコプターは劣駆動システムであり、推力方向（Z軸）を傾けることで水平方向の推進力を得る。

---

## 5. 設計変数（位置制御ゲイン）比較

今回は以下の3ケースで比較を行う。

| Case | 設定 | $K_p$ (比例) | $K_d$ (微分) | 特徴 |
| :--- | :--- | :--- | :--- | :--- |
| **Case 1** | 低ゲイン | 0.005 | 0.04 | 応答が遅い |
| **Case 2** | 中ゲイン | 0.04 | 0.2 | 適切（設計値） |
| **Case 3** | 高ゲイン | 5.0 | 0.1 | 振動的・不安定 |

※ 姿勢制御ゲインは全ケース共通で固定

---


## 6. シミュレーション結果 (時刻歴応答)

<div style="display: flex; align-items: flex-start; gap: 24px;">
   <div style="flex: 1; min-width: 0;">
      <img src="mat_data/position_control_result.png" alt="位置応答グラフ" style="width: 100%; max-width: 400px;">
   </div>
   <div style="flex: 1; min-width: 0;">
      <b>位置 ($X, Y, Z$) の収束挙動の比較</b><br>
      ※ Case 1は収束が遅く、Case 3は振動的であるのに対し、Case 2は速やかに収束している。
   </div>
</div>

---

## 7. 考察とまとめ

### 考察
- **低ゲイン (Case 1)**: 目標値への到達に時間を要する。
- **高ゲイン (Case 3)**: 制御入力が過大となり、姿勢角の急激な変化を招き、結果として位置が振動する。
- **最適ゲイン (Case 2)**: オーバーシュートを抑えつつ、最短時間で目標位置へ収束した。

### 結論
- 適切な位置制御ゲインの選定が、クアッドコプターの安定した位置制御に不可欠である。
- シミュレーションにより、実機実験前の安全なパラメータ調整が可能となった。
